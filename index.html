<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, notranslate, noimageindex">
    <title>Art & Wisdom Viewer</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            background-color: #e6f3ff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            padding-bottom: 80px; /* Space for the bottom bar */
        }

        .wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            background-color: rgba(173, 216, 230, 0.3);
            border-radius: 15px;
            max-width: 1200px;
            width: 100%;
            align-items: flex-start;
        }

        .box {
            flex: 1;
            min-width: 280px;
            max-width: 600px;
            background-color: rgba(200, 220, 240, 0.4);
            border-radius: 10px;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 300px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            transition: min-height 0.25s ease-out;
        }

        .box.content-shown {
            min-height: 1px;
        }

        .media-item-container img,
        .media-item-container iframe {
            cursor: pointer;
        }
        .media-title a {
            cursor: pointer;
        }

        .box-content {
            position: relative; width: 100%; height: auto; box-sizing: border-box;
            background-color: rgba(255, 255, 255, 0.97);
            border-radius: 10px; color: #2c3e50;
            opacity: 1; transform: scale(1) translateY(0); visibility: visible;
            max-height: none; padding: 0; overflow: hidden;
            display: flex; flex-direction: column;
        }

        .media-view, .placeholder-content-view {
            width: 100%; box-sizing: border-box; padding: 20px;
            opacity: 0; max-height: 0; overflow: hidden;
            transform: translateY(10px);
            transition: opacity 0.25s ease-out,
                        max-height 0.3s ease-out,
                        transform 0.25s ease-out;
        }
        .media-view.active-internal-view,
        .placeholder-content-view.active-internal-view {
            opacity: 1; max-height: 4000px; /* Increased max-height */
            transform: translateY(0);
        }

        .placeholder-content-view h2 {
            margin-top: 0;
            margin-bottom: 0.8em;
            color: #1a2533;
            font-size: 1.2em;
        }

        .media-item-container {
            width: 100%; margin-bottom: 15px; display: flex;
            justify-content: center; align-items: center;
        }
        .media-item-container img,
        .media-item-container iframe {
            max-width: 100%; max-height: 65vh;
            height: auto;
            border-radius: 5px; border: none; display: block;
        }
        .media-title {
            font-size: 1.0em; /* Adjusted for potentially longer captions */
            margin: 0; font-weight: bold; text-align: center;
            line-height: 1.4; /* Adjusted for multi-line */
        }
        .media-title a { color: #0056b3; text-decoration: none; }
        .media-title a:hover { text-decoration: underline; }
        .media-loading, .media-error {
            text-align: center; padding: 20px; font-style: italic; color: #777;
        }

        .tao-text-section {
            white-space: pre-wrap;
            margin-bottom: 1em;
            line-height: 1.6;
            font-size: 0.95em;
            text-align: left;
        }
        .tao-text-section:last-child {
            margin-bottom: 0;
        }

        .tao-attribution {
            font-size: 0.75em;
            color: #555;
            text-align: right;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #eaeaea;
        }
        .tao-attribution a {
            color: #0056b3;
            text-decoration: none;
        }
        .tao-attribution a:hover {
            text-decoration: underline;
        }

        .bottom-logo-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(40, 60, 100, 0.85); padding: 10px 15px; border-radius: 12px; box-shadow: 0 -2px 10px rgba(0,0,0,0.2); z-index: 1000; display: flex; gap: 12px; align-items: center; }
        .bottom-logo-bar a { display: inline-flex; align-items: center; justify-content: center; transition: transform 0.2s ease; padding: 3px; }
        .bottom-logo-bar a:hover { transform: scale(1.15); }
        .bottom-logo-bar img { height: 28px; width: auto; display: block; }
        .bottom-logo-bar span.img-alt-text { font-size: 10px; color: #fff; padding: 5px; display: inline-block; border: 1px solid #fff; border-radius: 3px; line-height: 1; }

    </style>
</head>
<body>
    <div class="wrapper">
        <div class="box" id="box1" onclick="handleMediaBoxClick(event)">
            <div class="box-content">
                <div class="media-view active-internal-view">
                    <div class="media-item-container">
                        <div class="media-loading">Loading Rijksmuseum Art...</div>
                    </div>
                    <h3 class="media-title"><a href="#" target="_blank" rel="noopener noreferrer">Rijksmuseum Art Title</a></h3>
                </div>
                <div class="placeholder-content-view">
                    <iframe frameborder="0" scrolling="no" class="weerplazaWidget" src="https://www.weerplaza.nl/weerwidgets/regenradar/?SXNGdWxsV2lkdGg9ZmFsc2UmSXNIRD10cnVlJlpvb21MZXZlbD03" style="width: 100% !important; max-width: 500px; height: 698px !important; padding: 10px; border: 1px solid rgb(244, 244, 244) !important; box-sizing: border-box !important;"></iframe>
                </div>
            </div>
        </div>

        <div class="box" id="box2" onclick="handleMediaBoxClick(event)">
            <div class="box-content">
                <div class="media-view active-internal-view">
                    <div class="media-item-container">
                        <div class="media-loading">Loading Metropolitan Museum Art...</div>
                    </div>
                    <h3 class="media-title">
                        <a href="#" target="_blank" rel="noopener noreferrer">Metropolitan Museum Art Title</a>
                    </h3>
                </div>
                <div class="placeholder-content-view">
                    <iframe frameborder="0" scrolling="no" class="weerplazaWidget" src="https://www.weerplaza.nl/weerwidgets/locatie/10728/?" style="width: 100% !important; max-width: 370px !important; height: 350px !important; padding: 10px; border: 1px solid rgb(244, 244, 244) !important; box-sizing: border-box !important;"></iframe>
                    <iframe frameborder="0" scrolling="no" class="weerplazaWidget" src="https://www.weerplaza.nl/weerwidgets/verwachting/10728/?" style="width: 100% !important; max-width: 370px !important; height: 350px !important; padding: 10px; border: 1px solid rgb(244, 244, 244) !important; box-sizing: border-box !important;"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!--
    <div class="bottom-logo-bar">
        <a href="https://mail.google.com/" target="_blank" rel="noopener noreferrer" title="Gmail"><img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg" alt="Gmail Logo" onerror="this.outerHTML = '<span class=\'img-alt-text\'>' + this.alt + '</span>'"></a>
        <a href="https://calendar.google.com/" target="_blank" rel="noopener noreferrer" title="Google Calendar"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Google_Calendar_icon_%282020%29.svg" alt="Google Calendar Logo" onerror="this.outerHTML = '<span class=\'img-alt-text\'>' + this.alt + '</span>'"></a>
        <a href="https://tasks.google.com/" target="_blank" rel="noopener noreferrer" title="Google Tasks"><img src="https://upload.wikimedia.org/wikipedia/commons/5/5b/Google_Tasks_2021.svg" alt="Google Tasks Logo" onerror="this.outerHTML = '<span class=\'img-alt-text\'>' + this.alt + '</span>'"></a>
        <a href="https://keep.google.com/" target="_blank" rel="noopener noreferrer" title="Google Keep"><img src="https://upload.wikimedia.org/wikipedia/commons/c/cb/Google_Keep_2020_Logo.svg" alt="Google Keep Logo" onerror="this.outerHTML = '<span class=\'img-alt-text\'>' + this.alt + '</span>'"></a>
        <a href="https://gemini.google.com/" target="_blank" rel="noopener noreferrer" title="Google Gemini"><img src="https://upload.wikimedia.org/wikipedia/commons/8/8f/Google-gemini-icon.svg" alt="Google Gemini Logo" onerror="this.outerHTML = '<span class=\'img-alt-text\'>' + this.alt + '</span>'"></a>
        <a href="https://www.google.com/maps" target="_blank" rel="noopener noreferrer" title="Google Maps"><img src="https://upload.wikimedia.org/wikipedia/commons/a/aa/Maps_icon_%282020%29.svg" alt="Google Maps Logo" onerror="this.outerHTML = '<span class=\'img-alt-text\'>' + this.alt + '</span>'"></a>
        <a href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer" title="YouTube"><img src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg" alt="YouTube Logo" onerror="this.outerHTML = '<span class=\'img-alt-text\'>' + this.alt + '</span>'"></a>
    </div>
    -->

    <script>
        const rijksApiKey = 'LCaM9ZlM'; // Your Rijksmuseum API Key

        function activateView(viewElement, boxElement) {
            requestAnimationFrame(() => {
                const currentScrollHeight = viewElement.scrollHeight;
                viewElement.style.maxHeight = currentScrollHeight + 'px';

                if (boxElement && !boxElement.classList.contains('content-shown')) {
                    boxElement.classList.add('content-shown');
                }
            });
        }

        // --- API Integration & Art Fetching ---
        // The following sections handle fetching data from different museum APIs.
        // Each museum has a different way of providing data, so they have their own dedicated functions.
        // The general structure is:
        // 1. A "fetch" function that communicates with the API to get artwork data.
        // 2. A "display" function that takes that data and puts it on the page.

        // --- Rijksmuseum Functions (for Box 1) ---
        /**
         * Fetches a random artwork from the Rijksmuseum's collection.
         * The Rijksmuseum API has a large collection but limits direct access to the first 10,000 items.
         * This function works around that by:
         * 1. First, checking the total number of available artworks with images.
         * 2. Calculating a random page number within the accessible limit (10,000 items).
         * 3. Fetching that random page of artworks.
         * 4. Picking one random artwork from that page's results.
         * 5. Fetching the full details for that single artwork to display it.
         *
         * Key API Parameters Used:
         * - key: Your personal API key (stored in the `rijksApiKey` variable).
         * - format: 'json' - We request the data in JSON format, which is easy to use in JavaScript.
         * - imgonly: 'true' - Filters for artworks that have an image available.
         * - ps: 'results per page' - How many items to return in one list (max 100).
         * - p: 'page number' - Which page of results to retrieve.
         */
        async function fetchRijksmuseumArt(boxElement) {
            const boxId = boxElement.id;
            const mediaView = boxElement.querySelector('.media-view');
            const mediaContainer = mediaView.querySelector('.media-item-container');
            const titleLink = mediaView.querySelector('.media-title a');

            if (!mediaContainer || !titleLink) {
                if (mediaContainer) mediaContainer.innerHTML = `<div class="media-error">Page Error: Display elements not found for Rijksmuseum.</div>`;
                else console.error("Critical Page Error: mediaContainer not found for Rijksmuseum in " + boxId);
                if (mediaView) activateView(mediaView, boxElement);
                else if (boxElement) boxElement.classList.add('content-shown');
                return;
            }
            mediaContainer.innerHTML = '<div class="media-loading">Loading Rijksmuseum Art...</div>';
            titleLink.textContent = 'Loading art data...';
            titleLink.href = '#';
            if (mediaView.classList.contains('active-internal-view')) {
                activateView(mediaView, boxElement);
            }

            const resultsPerPage = 100; // Max results per page from the API
            const baseUrl = `https://www.rijksmuseum.nl/api/en/collection?key=${rijksApiKey}&format=json&imgonly=true`;
            const maxAccessibleItems = 10000; // Rijksmuseum API pagination limit

            try {
                // First, find out the total number of artworks with images available.
                const countUrl = `${baseUrl}&ps=1`;
                const responseCount = await fetch(countUrl);
                if (!responseCount.ok) throw new Error(`Rijksmuseum API (count) error! status: ${responseCount.status}`);
                const dataCount = await responseCount.json();
                const totalArtworks = dataCount.count;
                if (!totalArtworks || totalArtworks === 0) {
                    throw new Error('No art objects with images found in Rijksmuseum collection.');
                }

                // The API limits pagination to the first 10,000 results.
                // We'll pick a random item from this accessible pool.
                const accessibleArtworks = Math.min(totalArtworks, maxAccessibleItems);
                const totalPages = Math.ceil(accessibleArtworks / resultsPerPage);

                // Calculate a random page number to fetch (API pages are 0-indexed).
                const randomPage = Math.floor(Math.random() * totalPages);

                // Fetch the list of artworks from that random page.
                const collectionUrl = `${baseUrl}&p=${randomPage}&ps=${resultsPerPage}`;
                const responseCollection = await fetch(collectionUrl);
                if (!responseCollection.ok) throw new Error(`Rijksmuseum API (collection) error! status: ${responseCollection.status}`);
                const dataCollection = await responseCollection.json();
                if (!dataCollection.artObjects || dataCollection.artObjects.length === 0) throw new Error('No art objects found on the randomly selected page. This can happen near the API pagination limit.');
                
                // Pick a random artwork from the results of that page.
                const randomIndex = Math.floor(Math.random() * dataCollection.artObjects.length);
                const randomArtObjectSummary = dataCollection.artObjects[randomIndex];
                const objectNumber = randomArtObjectSummary.objectNumber;

                // Fetch the detailed information for the chosen artwork.
                const detailUrl = `https://www.rijksmuseum.nl/api/en/collection/${objectNumber}?key=${rijksApiKey}&format=json`;
                const responseDetail = await fetch(detailUrl);
                if (!responseDetail.ok) throw new Error(`Rijksmuseum API (detail for ${objectNumber}) error! status: ${responseDetail.status}`);
                const dataDetail = await responseDetail.json();
                if (!dataDetail.artObject) throw new Error('Could not retrieve art object details from Rijksmuseum.');
                
                displayRijksmuseumArt(boxElement, dataDetail.artObject);
            } catch (error) {
                console.error("Error fetching Rijksmuseum art for " + boxId + ":", error);
                mediaContainer.innerHTML = `<div class="media-error">Failed to load Rijksmuseum art: ${error.message}</div>`;
                titleLink.textContent = 'Failed to load title';
                if (mediaView.classList.contains('active-internal-view')) {
                    activateView(mediaView, boxElement);
                }
            }
        }

        function displayRijksmuseumArt(boxElement, artData) {
            const mediaView = boxElement.querySelector('.media-view');
            const mediaContainer = mediaView.querySelector('.media-item-container');
            const titleLink = mediaView.querySelector('.media-title a');
            // console.log("Full artData for Rijksmuseum:", artData); // For debugging
            mediaContainer.innerHTML = '';
            const updateHeights = () => {
                if (mediaView.classList.contains('active-internal-view')) {
                    activateView(mediaView, boxElement);
                }
            };
            let imageUrlForDisplay = null;
            if (artData.webImage && artData.webImage.url) {
                imageUrlForDisplay = artData.webImage.url;
                const img = document.createElement('img');
                img.src = imageUrlForDisplay;
                img.alt = artData.title || "Rijksmuseum Art";
                img.onload = updateHeights;
                img.onerror = () => {
                    mediaContainer.innerHTML = `<div class="media-error">Rijksmuseum image failed to load.</div>`;
                    updateHeights();
                };
                mediaContainer.appendChild(img);
            } else {
                mediaContainer.innerHTML = `<div class="media-error">Rijksmuseum image not available.</div>`;
                updateHeights();
            }
            let caption = artData.title || "Untitled Artwork";
            const year = artData.dating && artData.dating.presentingDate ? artData.dating.presentingDate : null;
            if (year) caption += ` (${year})`;
            if (artData.materials && Array.isArray(artData.materials) && artData.materials.length > 0) {
                caption += `\nMaterials: ${artData.materials.join(', ')}`;
            }
            if (artData.techniques && Array.isArray(artData.techniques) && artData.techniques.length > 0) {
                caption += `\nTechniques: ${artData.techniques.join(', ')}`;
            }
            const artist = artData.principalMakers && artData.principalMakers.length > 0 ? artData.principalMakers[0] : null;
            if (artist && artist.name) {
                caption += `\n${artist.name}`;
                const birthYearStr = artist.dateOfBirth ? String(artist.dateOfBirth).substring(0, 4) : null;
                const deathYearStr = artist.dateOfDeath ? String(artist.dateOfDeath).substring(0, 4) : null;
                if (birthYearStr && deathYearStr) caption += ` (${birthYearStr}–${deathYearStr})`;
                else if (birthYearStr) caption += ` (b. ${birthYearStr})`;
                else if (deathYearStr) caption += ` (d. ${deathYearStr})`;
            }
            titleLink.style.whiteSpace = 'pre-line';
            titleLink.textContent = caption;
            const imageLinkForCaption = imageUrlForDisplay || '#';
            titleLink.href = imageLinkForCaption;
            if (imageLinkForCaption === '#') {
                titleLink.target = '';
                titleLink.removeAttribute('rel');
            } else {
                titleLink.target = '_blank';
                titleLink.rel = 'noopener noreferrer';
            }
            if (!imageUrlForDisplay) updateHeights();
        }

        // --- Metropolitan Museum of Art Functions (for Box 2) ---
        /**
         * Fetches a random artwork from the Metropolitan Museum of Art's collection.
         * This API is simpler and does not require an API key.
         * This function works by:
         * 1. Searching for highlighted artworks that are supposed to have images.
         * 2. This search returns a list of IDs for all matching artworks.
         * 3. It then picks a random ID from the list and fetches the full details for that artwork.
         * 4. IMPORTANT: Sometimes an artwork marked as having an image doesn't have a usable one.
         *    To handle this, the function will "retry" up to 10 times with a new random ID until
         *    it finds an artwork that has a valid image URL.
         *
         * Key API Parameters Used:
         * - isHighlight: 'true' - Narrows the search to only include major works in the collection. Can be set to 'false' for a wider selection.
         * - hasImages: 'true' - Filters for artworks that are flagged as having an image. This should be kept 'true'.
         * - q: 'a' - A very broad search query ('a' appears in most titles/descriptions) to get a large
         *   and varied list of artworks. You could change this to something more specific,
         *   like 'q=sunflowers' to get art related to sunflowers, or 'q=monet' to search for a specific artist.
         */
        async function fetchMetArt(boxElement) {
            const boxId = boxElement.id;
            const mediaView = boxElement.querySelector('.media-view');
            const mediaContainer = mediaView.querySelector('.media-item-container');
            const titleLink = mediaView.querySelector('.media-title a');

            if (!mediaContainer || !titleLink) {
                if (mediaContainer) mediaContainer.innerHTML = `<div class="media-error">Page Error: Display elements not found for Met Art.</div>`;
                else console.error("Critical Page Error: mediaContainer not found for Met Art in " + boxId);
                if (mediaView) activateView(mediaView, boxElement);
                else if (boxElement) boxElement.classList.add('content-shown');
                return;
            }
            mediaContainer.innerHTML = '<div class="media-loading">Loading Metropolitan Museum Art...</div>';
            titleLink.textContent = 'Loading art data...';
            titleLink.href = '#';
            if (mediaView.classList.contains('active-internal-view')) {
                activateView(mediaView, boxElement);
            }
            const searchUrl = `https://collectionapi.metmuseum.org/public/collection/v1/search?isHighlight=true&hasImages=true&q=a`;
            try {
                const responseSearch = await fetch(searchUrl);
                if (!responseSearch.ok) throw new Error(`Met API (search) error! status: ${responseSearch.status}`);
                const dataSearch = await responseSearch.json();
                if (!dataSearch.objectIDs || dataSearch.objectIDs.length === 0) throw new Error('No art objects found from Met API search.');
                
                let artDataWithImage = null;
                const maxRetries = 10; // Number of times to try finding an artwork with an image.

                for (let i = 0; i < maxRetries; i++) {
                    const randomIndex = Math.floor(Math.random() * dataSearch.objectIDs.length);
                    const randomObjectID = dataSearch.objectIDs[randomIndex];
                    const detailUrl = `https://collectionapi.metmuseum.org/public/collection/v1/objects/${randomObjectID}`;
                    
                    try {
                        const responseDetail = await fetch(detailUrl);
                        if (!responseDetail.ok) {
                            console.warn(`Met API detail fetch for ${randomObjectID} failed. Retrying...`);
                            continue; // Skip to next iteration of the loop.
                        }
                        
                        const artData = await responseDetail.json();
                        // Check if the artwork has a primary image URL.
                        if (artData && artData.primaryImage && artData.primaryImage.length > 0) {
                            artDataWithImage = artData;
                            break; // Successfully found an artwork with an image, so exit the loop.
                        }
                    } catch (fetchError) {
                        console.warn(`Network error fetching Met object ${randomObjectID}:`, fetchError, 'Retrying...');
                    }
                }

                if (artDataWithImage) {
                    displayMetArt(boxElement, artDataWithImage);
                } else {
                    // If no artwork with an image was found after all retries, throw an error.
                    throw new Error(`Failed to find an artwork with an image after ${maxRetries} attempts.`);
                }
            } catch (error) {
                console.error("Error fetching Metropolitan Museum art for " + boxId + ":", error);
                mediaContainer.innerHTML = `<div class="media-error">Failed to load Met art: ${error.message}</div>`;
                titleLink.textContent = 'Failed to load title';
                if (mediaView.classList.contains('active-internal-view')) {
                    activateView(mediaView, boxElement);
                }
            }
        }

        function displayMetArt(boxElement, artData) {
            const mediaView = boxElement.querySelector('.media-view');
            const mediaContainer = mediaView.querySelector('.media-item-container');
            const titleLink = mediaView.querySelector('.media-title a');
            // console.log("Full artData for Met Museum:", artData); // For debugging
            mediaContainer.innerHTML = '';
            const updateHeights = () => {
                if (mediaView.classList.contains('active-internal-view')) {
                    activateView(mediaView, boxElement);
                }
            };
            let imageUrlForDisplay = null;
            if (artData.primaryImage && artData.primaryImage.length > 0) {
                imageUrlForDisplay = artData.primaryImage;
                const img = document.createElement('img');
                img.src = imageUrlForDisplay;
                img.alt = artData.title || "Metropolitan Museum Art";
                img.onload = updateHeights;
                img.onerror = () => {
                    mediaContainer.innerHTML = `<div class="media-error">Met Museum image failed to load.</div>`;
                    updateHeights();
                };
                mediaContainer.appendChild(img);
            } else {
                mediaContainer.innerHTML = `<div class="media-error">Met Museum image not available.</div>`;
                updateHeights();
            }
            let caption = artData.title || "Untitled Artwork";
            let yearString = artData.objectDate || "";
            if (!yearString && artData.objectBeginDate) {
                yearString = String(artData.objectBeginDate);
                if (artData.objectEndDate && artData.objectBeginDate !== artData.objectEndDate) {
                    yearString += `–${artData.objectEndDate}`;
                }
            }
            if (yearString) caption += ` (${yearString})`;
            if (artData.medium && artData.medium.length > 0) {
                caption += `\n${artData.medium}`;
            }
            let artistName = artData.artistDisplayName || "";
            let artistBioForYears = artData.artistDisplayBio || "";
            let artistBeginDate = artData.artistBeginDate ? String(artData.artistBeginDate) : null;
            let artistEndDate = artData.artistEndDate ? String(artData.artistEndDate) : null;
            if (!artistName && artData.constituents && artData.constituents.length > 0) {
                const primaryArtist = artData.constituents.find(c => c.role === "Artist" || c.role === "Maker"); // Broaden role check
                if (primaryArtist) artistName = primaryArtist.name;
            }
            if (artistName) {
                caption += `\n${artistName}`;
                if (artistBeginDate && artistEndDate) {
                    caption += ` (${artistBeginDate}–${artistEndDate})`;
                } else if (artistBeginDate) {
                    caption += ` (b. ${artistBeginDate})`;
                } else if (artistEndDate) {
                    caption += ` (d. ${artistEndDate})`;
                } else if (artistBioForYears) {
                    const yearMatch = artistBioForYears.match(/\b(\d{4})\b(?:[^\d,]*(?:–|-)\s*(\d{4}))?\b/); // Improved regex for YYYY-YYYY or YYYY
                    if (yearMatch) {
                        const birth = yearMatch[1];
                        const death = yearMatch[2];
                        if (birth && death) caption += ` (${birth}–${death})`;
                        else if (birth) caption += ` (b. ${birth})`;
                    }
                }
            }
            titleLink.style.whiteSpace = 'pre-line';
            titleLink.textContent = caption;
            const imageLinkForCaption = imageUrlForDisplay || '#';
            titleLink.href = imageLinkForCaption;
            if (imageLinkForCaption === '#') {
                titleLink.target = '';
                titleLink.removeAttribute('rel');
            } else {
                titleLink.target = '_blank';
                titleLink.rel = 'noopener noreferrer';
            }
            if (!imageUrlForDisplay) updateHeights();
        }

        // --- Generic Click Handler & DOMContentLoaded ---
        function handleMediaBoxClick(event) {
            const box = event.currentTarget;
            const mediaView = box.querySelector('.media-view');
            const placeholderView = box.querySelector('.placeholder-content-view');

            // If a link was clicked, let the browser handle it and don't toggle the view.
            if (event.target.closest('a')) {
                return;
            }

            // Clicks inside a cross-origin iframe won't be detected here, which is expected.

            const isPlaceholderActive = placeholderView.classList.contains('active-internal-view');

            if (isPlaceholderActive) {
                // If the widget/placeholder is visible, any click on the box (that's not a link)
                // should switch back to the image view.
                placeholderView.classList.remove('active-internal-view');
                placeholderView.style.maxHeight = '0px';
                mediaView.classList.add('active-internal-view');
                activateView(mediaView, box);
            } else {
                // If the image view is visible, only a click on the image itself should
                // switch to the placeholder view.
                const clickedOnMediaItem = event.target.closest('.media-item-container img, .media-item-container iframe');
                if (clickedOnMediaItem) {
                    mediaView.classList.remove('active-internal-view');
                    mediaView.style.maxHeight = '0px';
                    placeholderView.classList.add('active-internal-view');
                    activateView(placeholderView, box);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const box1 = document.getElementById('box1');
            const box1MediaView = box1.querySelector('.media-view');
            box1.classList.add('content-shown');
            box1MediaView.classList.add('active-internal-view');
            fetchRijksmuseumArt(box1);

            const box2 = document.getElementById('box2');
            const box2MediaView = box2.querySelector('.media-view');
            box2.classList.add('content-shown');
            box2MediaView.classList.add('active-internal-view');
            fetchMetArt(box2);
        });
    </script>
</body>
</html>
